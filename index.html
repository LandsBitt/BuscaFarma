<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="shortcut icon" href="imagens/Icon.png" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
    rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <!-- Box Icons -->
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  <!-- Manifest -->
  <link rel="manifest" href="manifest.json">
  <!-- AOS CSS -->
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <title>BuscaFarma</title>
</head>

<body>
  <nav>
    <div id="logo">
      <a href='/'>
        <img src="imagens/BuscaFarma-removebg-preview.png" alt="Busca Farma Logo">
      </a>
    </div>

    <div class="nav-links" id="nav-menu">
      <ul>
        <li><a href="#" class="nav-item active">Farmacias</a></li>
        <li><a href="#quem-somos" class="nav-item">Quem somos</a></li>
        <li><a href="divulgue.html" class="nav-item">Divulgue aqui</a></li>
        <li><a href="#" class="nav-item">Apoie</a></li>
      </ul>
    </div>

    <!-- Novo Bot√£o Hamb√∫rguer -->
    <button class="menu-toggle" aria-label="Menu" aria-expanded="false" aria-controls="nav-menu">
      <span class="hamburger"></span>
    </button>
  </nav>

  <!-- Resto do HTML permanece igual -->
  <section class="wellcome">
    <h1>Farm√°cias Trememb√©</h1>
    <div class="search-container">
      <input type="text" id="search-input" placeholder="Buscar farm√°cia...">
    </div>
  </section>

  <section class="farmacias" id="farmacias-list" aria-labelledby="farmacias-heading" tabindex="0">
    <!-- Farmacias ser√£o inseridas aqui pelo JavaScript -->
  </section>

  <section class="quem-somos" id="quem-somos" tabindex="0">
    <div class="container">
      <h2>Quem Somos</h2>
      <div class="content-wrapper">
        <p>
          <span class="icon">üéì</span> Somos estudantes de An√°lise e Desenvolvimento de Sistemas na UNITAU, e o BuscaFarma √© nosso projeto para aplicar o que aprendemos em algo √∫til para a comunidade.
        </p>
        <p>
          <span class="icon">üí°</span> A ideia √© simples: facilitar a busca por farm√°cias em Trememb√©, centralizando informa√ß√µes importantes em um s√≥ lugar.
        </p>
        <p>
          <span class="icon">üöÄ</span> Estamos em constante aprendizado e evolu√ß√£o. Obrigado por fazer parte da nossa jornada!
        </p>
        <a href="time.html" class="team-link">Conhe√ßa o Time</a>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer" tabindex="0">
    <div class="footer-container">
      <div class="footer-logo">
        <a href="#home">
          <img src="imagens/BuscaFarma_footer.png" alt="Logo BuscaFarma">
        </a>
      </div>
      <div class="footer-links">
        <h3>Navega√ß√£o</h3>
        <ul>
          <li><a href="#" class="nav-item">Farmacias</a></li>
          <li><a href="#quem-somos" class="nav-item">Quem somos</a></li>
          <li><a href="divulgue.html" class="nav-item">Divulgue aqui</a></li>
          <li><a href="#" class="nav-item">Apoie</a></li>
        </ul>
      </div>
      <div class="footer-social">
        <h3>Redes Sociais</h3>
        <div class="social-icons">
          <a href="https://instagram.com" target="_blank" aria-label="Instagram"><i class='bx bxl-instagram'></i></a>
          <a href="https://facebook.com" target="_blank" aria-label="Facebook"><i class='bx bxl-facebook'></i></a>
          <a href="https://twitter.com" target="_blank" aria-label="Twitter"><i class='bx bxl-twitter'></i></a>
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2025 BuscaFarma. Todos os direitos reservados ao <strong>Time BuscaFarma</strong>.</p>
    </div>
  </footer>

  <div id="myModal" class="modal">
    <div class="modal-content modern-modal animate-modal">
      <button class="close-btn" aria-label="Fechar">&times;</button>
      <div class="modal-header">
        <div class="modal-icon"><i class='bx bxs-capsule'></i></div>
        <div>
          <h2 id="modal-title" class="modal-title"></h2>
          <span id="modal-location" class="modal-location"></span>
        </div>
      </div>
      <div class="modal-body">
        <p id="modal-description" class="modal-description"></p>
        <div id="modal-horario" class="modal-horario"></div>
      </div>
    </div>
  </div>

  <div id="mapModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" id="closeMapBtn">&times;</span>
      <h3 id="map-modal-title"></h3>
      <div class="map-container">
        <iframe id="googleMapIframe" width="100%" height="450" frameborder="0" style="border:0" allowfullscreen=""
          aria-hidden="false" tabindex="0"></iframe>
      </div>
    </div>
  </div>

  <div class="accessibility-floating-btn">
    <button id="toggle-hover-reading" class="accessibility-btn" onclick="toggleHoverReading()"
      aria-label="Ativar leitura por hover">
      <i class='bx bx-volume-full'></i>
    </button>
  </div>

  <script src="scriptAcessebilidade.js"></script>
  <script>
    // Efeito de scroll na navbar
    window.addEventListener('scroll', function () {
      const nav = document.querySelector('nav');
      if (window.scrollY > 20) {
        nav.classList.add('scrolled');
      } else {
        nav.classList.remove('scrolled');
      }
    });

    // Highlight do item ativo
    document.querySelectorAll('.nav-links a').forEach(link => {
      link.addEventListener('click', function () {
        document.querySelectorAll('.nav-links a').forEach(item => {
          item.classList.remove('active');
        });
        this.classList.add('active');
      });
    });

    // Novo JavaScript para o bot√£o hamb√∫rguer
    const menuToggle = document.querySelector('.menu-toggle');
    const navLinks = document.querySelector('.nav-links');

    menuToggle.addEventListener('click', () => {
      const expanded = menuToggle.getAttribute('aria-expanded') === 'true' || false;
      menuToggle.setAttribute('aria-expanded', !expanded);
      navLinks.classList.toggle('active');
    });

    // Carregar e exibir farm√°cias
    const farmaciasList = document.getElementById('farmacias-list');
    const searchInput = document.getElementById('search-input');
    let allFarmacias = [];

    fetch('farmacias.json')
      .then(response => response.json())
      .then(data => {
        allFarmacias = data;
        displayFarmacias(allFarmacias);
      });

    function displayFarmacias(farmacias) {
      farmaciasList.innerHTML = '';
      farmacias.forEach((farmacia, index) => {
        const farmaciaArticle = document.createElement('article');
        farmaciaArticle.classList.add('farmacia');

        const containerDiv = document.createElement('div');
        containerDiv.classList.add('container');
        if (index % 2 !== 0) {
          containerDiv.classList.add('reverse');
        }

        containerDiv.innerHTML = `
          <div class="info">
            <h3>${farmacia.nome}</h3>
            <p>${farmacia.descricao}</p>
            <div class="buttons">
              <button class="primary" aria-label="Saiba mais sobre ${farmacia.nome}" data-localizacao="${farmacia.localizacao}" data-horario="${farmacia.horario}"><i class='bx bx-info-circle'></i> Saiba mais</button>
              <a href="https://wa.me/${farmacia.whatsapp}" target="_blank" class="secondary" aria-label="Contato WhatsApp da ${farmacia.nome}"><i class='bx bxl-whatsapp'></i> Contato WhatsApp</a>
              <button class="tertiary" aria-label="Ver rota para ${farmacia.nome}" data-localizacao="${farmacia.localizacao}"><i class='bx bx-map'></i> Rota</button>
            </div>
          </div>
          <img src="${farmacia.imagem}" alt="Fachada da farm√°cia ${farmacia.nome}" class="farmacia-img" loading="lazy">
        `;

        farmaciaArticle.appendChild(containerDiv);
        farmaciasList.appendChild(farmaciaArticle);
      });

      // Re-inicializar eventos do modal
      initializeModalEvents();
      initializeMapModalEvents();
    }

    // Busca
    searchInput.addEventListener('input', (e) => {
      const searchTerm = e.target.value.toLowerCase();
      const filteredFarmacias = allFarmacias.filter(farmacia =>
        farmacia.nome.toLowerCase().includes(searchTerm)
      );
      displayFarmacias(filteredFarmacias);
    });

    // Modal Saiba Mais
    const modal = document.getElementById("myModal");
    const closeBtn = document.querySelector(".close-btn");
    const modalTitle = document.getElementById("modal-title");
    const modalDescription = document.getElementById("modal-description");
    const modalLocation = document.getElementById("modal-location");
    const modalHorario = document.getElementById("modal-horario");

    function initializeModalEvents() {
      const saibaMaisButtons = document.querySelectorAll('.primary');
      saibaMaisButtons.forEach((button, idx) => {
        button.addEventListener('click', () => {
          const farmaciaArticle = button.closest('.farmacia');
          const title = farmaciaArticle.querySelector('h3').textContent;
          const description = farmaciaArticle.querySelector('p').textContent;
          const location = button.dataset.localizacao;

          // Buscar a farm√°cia correspondente pelo nome (garante que pega o objeto certo)
          const farmacia = allFarmacias.find(f => f.nome === title);

          modalTitle.textContent = title;
          modalDescription.textContent = description;
          modalLocation.innerHTML = `<i class='bx bx-map'></i> ${location}`;

          // Exibir tabela de hor√°rios a partir do array 'horarios'
          if (farmacia && Array.isArray(farmacia.horarios)) {
            const horariosList = farmacia.horarios.map(h =>
              `<tr><td class="horario-dia"><i class='bx bx-calendar'></i> ${h.dia}</td><td class="horario-hora"><i class='bx bx-time'></i> ${h.horario}</td></tr>`
            ).join('');
            modalHorario.innerHTML = `
              <div class="horario-table-wrapper">
                <span class="horario-title"><i class='bx bx-time-five'></i> Hor√°rio de Funcionamento</span>
                <table class="horario-table">
                  <tbody>${horariosList}</tbody>
                </table>
              </div>
            `;
          } else {
            // fallback para farm√°cias sem hor√°rios estruturados
            modalHorario.innerHTML = `<div class="horario-table-wrapper"><span class="horario-title"><i class='bx bx-time-five'></i> Hor√°rio de Funcionamento</span><div>N√£o informado</div></div>`;
          }

          modal.style.display = "block";
          document.body.style.overflow = 'hidden'; // Bloqueia scroll
          setTimeout(() => {
            document.querySelector('.modern-modal').classList.add('show');
          }, 10);
        });
      });
    }

    closeBtn.addEventListener('click', closeModal);
    window.addEventListener('click', (event) => {
      if (event.target == modal) {
        closeModal();
      }
    });
    function closeModal() {
      document.querySelector('.modern-modal').classList.remove('show');
      setTimeout(() => {
        modal.style.display = "none";
        document.body.style.overflow = '';
      }, 250);
    }

    // Modal Mapa
    const mapModal = document.getElementById("mapModal");
    const closeMapBtn = document.getElementById("closeMapBtn");
    const mapModalTitle = document.getElementById("map-modal-title");
    const googleMapIframe = document.getElementById("googleMapIframe");

    function initializeMapModalEvents() {
      const rotaButtons = document.querySelectorAll('.tertiary');

      rotaButtons.forEach(button => {
        button.addEventListener('click', () => {
          const farmaciaArticle = button.closest('.farmacia');
          const title = farmaciaArticle.querySelector('h3').textContent;
          const location = button.dataset.localizacao;

          mapModalTitle.textContent = `Rota para ${title}`;
          const mapUrl = `https://www.google.com/maps?q=${encodeURIComponent(location)}&output=embed`;
          googleMapIframe.src = mapUrl;
          mapModal.style.display = "block";

        });
      });
    }

    closeMapBtn.addEventListener('click', () => {
      mapModal.style.display = "none";
      googleMapIframe.src = ""; // Clear iframe src to stop video/audio
    });

    window.addEventListener('click', (event) => {
      if (event.target == mapModal) {
        mapModal.style.display = "none";
        googleMapIframe.src = ""; // Clear iframe src to stop video/audio
      }
    });

  </script>
  <script>(function () { function c() { var b = a.contentDocument || a.contentWindow.document; if (b) { var d = b.createElement('script'); d.innerHTML = "window.__CF$cv$params={r:'93bdb49eb9c3ed87',t:'MTc0NjU4OTMyNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);"; b.getElementsByTagName('head')[0].appendChild(d) } } if (document.body) { var a = document.createElement('iframe'); a.height = 1; a.width = 1; a.style.position = 'absolute'; a.style.top = 0; a.style.left = 0; a.style.border = 'none'; a.style.visibility = 'hidden'; document.body.appendChild(a); if ('loading' !== document.readyState) c(); else if (window.addEventListener) document.addEventListener('DOMContentLoaded', c); else { var e = document.onreadystatechange || function () { }; document.onreadystatechange = function (b) { e(b); 'loading' !== document.readyState && (document.onreadystatechange = e, c()) } } } })();</script>
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker
          .register("service-worker.js")
          .then((reg) => console.log("Service Worker registrado", reg.scope))
          .catch((err) => console.error("Erro no Service Worker", err));
      });
    }
  </script>

</body>

</html>